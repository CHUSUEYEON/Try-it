<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>main</title>
</head>
<style>
  header {
    background-color: #3335;
    color: white;
    padding: 15px;
    text-align: end;
  }

  h1 {
    font-size: 24px;
    margin-top: 40px;
    text-align: center;
  }
</style>
<body>
  <header>
    <div>
      <a href="orders">ì£¼ë¬¸ </a>
      <a href="coupon">ì¿ í°í•¨</a>
    </div>
  </header>
  <h1> Welcome to Try-it </h1>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
<!--        const token = localStorage.getItem('jwtToken');-->
<!--        if(!token){-->
<!--         console.error("í† í°ì´ ì—†ìŠµë‹ˆë‹¤.");-->
<!--         return;-->
<!--         }-->

<!--         axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;-->
<!--         console.log(token);-->
<!--         rendering();-->

<!--         async function rendering(){-->
<!--          try{-->
<!--            const res = await axios.get('/pages/main');-->
<!--            console.log(res.data);-->
<!--          }catch(error => {-->
<!--             console.error("ë©”ì¸ í˜ì´ì§€ ìš”ì²­ ì‹¤íŒ¨ ", error);-->
<!--         });-->
    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° SSE ì—°ê²° ì„¤ì •
    function checkLoginStatus() {
        const token = localStorage.getItem('jwtToken');

         if (token) {
        connectToNotifications();
      }
    }

    // SSE ì—°ê²° í•¨ìˆ˜
    function connectToNotifications() {
        const token = localStorage.getItem('jwtToken');
        const eventSource = new EventSource(`/users/notifications/connect?token=${token}`);

        eventSource.addEventListener('sse', function(event) {
            if (typeof event.data === 'string' && !event.data.startsWith('EventStream')) {
                let data;
                try {
                    data = JSON.parse(event.data);
                } catch (e) {
                    console.error('Failed to parse event data:', e);
                    return;
                }

                if (data.alarmTitle) {
                    alert(`[${data.alarmTitle}]ì´ ë„ì°©í–ˆì–´ìš”~~~ğŸ˜˜ \nì¿ í°í•¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”!`);
                } else {
                    console.error('alarmTitle not found in event data');
                }
            }
        });

        eventSource.onerror = function(error) {
            console.error('SSE connection error:', error);
            eventSource.close(); // ì—ëŸ¬ ì‹œ SSE ì—°ê²° ë‹«ê¸°
        };
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    checkLoginStatus();
});

  </script>
</body>
</html>